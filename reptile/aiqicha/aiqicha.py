import os, sys, pickle

from time import sleep
import pandas as pd

from selenium import webdriver
from selenium.webdriver.chrome.service import Service
from selenium.webdriver.chrome.options import Options
from selenium.webdriver.common.by import By


class aiqicha:
    def __init__(self):
        self.BASE_DIR = os.path.dirname(os.path.realpath(sys.argv[0]))

        options = Options()
        options.add_experimental_option("debuggerAddress", "127.0.0.1:9527")
        s = Service(executable_path=os.path.join(self.BASE_DIR, "utils\\chromedriver.exe"))
        self.bro = webdriver.Chrome(service=s, options=options)
        self.company_data = []
        self.school_data = []

    # 公司抓取
    def company_reptile(self):
        self.bro.get(
            "https://aiqicha.baidu.com/s?q=%E4%B8%AD%E7%A7%91%E9%99%A2%E7%A6%8F%E5%BB%BA%E7%89%A9%E8%B4%A8%E7%BB%93%E6%9E%84%E7%A0%94%E7%A9%B6%E6%89%80&t=0")
        company = []
        import tools
        company_data = tools.load_json_name("公司[无].txt")
        for i in company_data:
            if i['name'] != '':
                company.append(i['name'])

        for i in company:
            data_dict = dict()
            data_dict["search"] = i
            search_input_ex = self.bro.find_element(By.XPATH, "//input[@id='aqc-header-search-input']")
            search_input_ex.clear()
            search_input_ex.send_keys(i)

            search_button_ex = self.bro.find_element(By.XPATH,
                                                     "//button[@class='search-btn' and contains(text(), '搜索')]")
            search_button_ex.click()

            # 处理检测机制
            sleep(10)
            for i in range(1, 720):
                if True:
                    try:
                        self.bro.find_element(By.XPATH,
                                              "//div[contains(@class,'mod-vcode-content-mkd')]/p[text()='百度安全验证']")
                        sleep(1)
                        print("请进行人工验证")
                    except:
                        break

            try:
                company_title_ex = self.bro.find_element(By.XPATH,
                                                         "//div[@class='company-list']/div[1]//h3[@class='title']/a[1]")
                company_title = company_title_ex.get_attribute("title")
                data_dict['company_title'] = company_title
            except:
                company_title = "null"
                data_dict['company_title'] = company_title

            # 成立时间
            try:
                company_date_ex = self.bro.find_element(By.XPATH,
                                                        "//div[@class='company-list']/div[1]//span[@class='pre-title' and text()='成立时间：']/following-sibling::span")
                company_date = company_date_ex.text
                data_dict['company_date'] = company_date
            except:
                company_date = "null"
                data_dict['company_date'] = company_date

            # 地址
            try:
                company_address_ex = self.bro.find_element(By.XPATH,
                                                           "//div[@class='company-list']/div[1]//span[@class='pre-title' and text()='地址：']/following-sibling::span")
                company_address = company_address_ex.text
                data_dict['company_address'] = company_address
            except:
                company_address = "null"
                data_dict['company_address'] = company_address

            print(data_dict)
            self.company_data.append(data_dict)
            self.export_data(self.company_data)

    # 学校地址抓取
    def college_reptile(self):
        school_list = ['浙江理工大学',
                       '南开大学',
                       '华南农业大学',
                       '华中科技大学',
                       '电子科技大学',
                       '浙江工业大学',
                       '中国科学技术大学',
                       '东华大学',
                       '燕山大学',
                       '河海大学',
                       '南方医科大学南方医院',
                       '华南师范大学',
                       '同济大学',
                       '华东师范大学',
                       '东南大学',
                       '华南理工大学',
                       '华东理工大学',
                       '浙江大学',
                       '西南石油大学',
                       '西北大学',
                       '华北电力大学',
                       '西北工业大学',
                       '长江大学',
                       '华中师范大学',
                       '中国药科大学',
                       '中南大学',
                       '浙江师范大学',
                       '中国人民解放军海军工程大学',
                       '广东华中科技大学工业技术研究院',
                       '西南交通大学',
                       '江南大学',
                       '西南大学',
                       '江西中医药大学',
                       '庆尚大学校产学协力团',
                       '鲁东大学',
                       '中国石油大学(华东)',
                       '中国农业大学',
                       '中国人民解放军陆军工程大学',
                       '顺天乡大学校产学协力团',
                       '中南大学湘雅医院',
                       '中南林业科技大学',
                       '北方工业大学',
                       '福建农林大学',
                       '首都师范大学',
                       '蔚山大学校产学协力团',
                       '江西理工大学',
                       '暨南大学',
                       '斯特拉斯堡大学',
                       '东海大学',
                       '利伯西科技大学',
                       '江南大学(如皋)食品生物技术研究所',
                       '江西师范大学',
                       '中南民族大学',
                       '匈牙利科学院大学及其他机构附属研究所',
                       '中国人民解放军国防科技大学',
                       '中国海洋大学',
                       '浙江海洋大学',
                       '牛津大学创新有限公司',
                       '南方医科大学',
                       '南方科技大学',
                       '福建师范大学泉港石化研究院',
                       '中北大学',
                       '五邑大学',
                       '西北农林科技大学',
                       '浙江农林大学',
                       '西南民族大学',
                       '西南科技大学',
                       '中南大学湘雅二医院',
                       '广东工业大学',
                       '梨花女子大学校产学协力团',
                       '雷恩第一大学',
                       '中国计量大学',
                       '沈阳药科大学',
                       '华中农业大学',
                       '沈阳建筑大学',
                       '沈阳航空航天大学',
                       '福建师范大学福清分校',
                       '浙江工商大学',
                       '中国人民解放军信息工程大学',
                       '浙江理工大学上虞工业技术研究院有限公司',
                       '长安大学',
                       '福建师范大学',
                       '三峡大学',
                       '南华大学',
                       '华侨大学',
                       '南宁师范大学',
                       '西华大学',
                       '广东医科大学',
                       '吉首大学',
                       '曲阜师范大学',
                       '华北理工大学',
                       '中国人民解放军战略支援部队信息工程大学',
                       '北方民族大学',
                       '莫纳什大学',
                       '沈阳农业大学',
                       '东华理工大学',
                       '广东药科大学',
                       '中国人民解放军战略支援部队航天工程大学',
                       '沈阳化工大学',
                       '中国科学院大学',
                       '利摩日大学',
                       '中央民族大学',
                       '中国人民解放军第四军医大学',
                       '闽南师范大学',
                       '中国人民解放军海军军医大学第一附属医院',
                       '中国人民解放军第二军医大学',
                       '福建医科大学附属第一医院',
                       '景德镇陶瓷大学',
                       '高雄医学大学',
                       '中国科学技术大学先进技术研究院',
                       '西湖大学',
                       '西华师范大学',
                       '济州大学校产学协力团',
                       '中国民航大学',
                       '沈阳工业大学',
                       '首都经济贸易大学',
                       '齐鲁工业大学',
                       '建国大学校产学协力团',
                       '中国人民解放军陆军军医大学第一附属医院',
                       '石河子大学',
                       '浙江理工大学瓯海研究院有限公司',
                       '浙江大学城市学院',
                       '天府新区西南交通大学研究院',
                       '广东海洋大学',
                       '苏黎世大学',
                       '中国人民解放军空军工程大学',
                       '江西农业大学',
                       '森梅威思大学',
                       '赣南师范大学',
                       '广东技术师范大学',
                       '华北水利水电大学',
                       '罗切斯特大学',
                       '韦恩州立大学',
                       '西北师范大学',
                       '浙江大学滨海产业技术研究院',
                       '鲁汶天主教大学',
                       '南洋理工大学',
                       '赛丹思科大学',
                       '西北工业大学太仓长三角研究院',
                       '余姚市浙江大学机器人研究中心',
                       '西南科技大学城市学院',
                       '中国医科大学附属第一医院',
                       '马来亚大学',
                       '东南大学溧阳研究院',
                       '浙江大学台州研究院',
                       '华东交通大学',
                       '浙江大学华南工业技术研究院',
                       '首都医科大学宣武医院',
                       '中国人民公安大学',
                       '根特大学',
                       '高丽大学校产学协力团',
                       '延世大学工业学术合作社',
                       '釜庆大学校产学协力团',
                       '北华大学',
                       '马萨诸塞州大学',
                       '辅仁大学学校财团法人辅仁大学',
                       '米纳斯吉拉斯联合大学',
                       '亚利桑那大学董事会',
                       '福建医科大学附属协和医院',
                       '中国人民大学',
                       '京畿大学校产学协力团',
                       '岭南大学校产学协力团',
                       '孟斐斯大学',
                       '首都医科大学',
                       '华中科技大学同济医学院附属协和医院',
                       '延世大学校产学协力团',
                       '中国人民解放军空军工程大学航空机务士官学校',
                       '长庚大学',
                       '中国石油大学胜利学院',
                       '中国传媒大学',
                       '中南大学湘雅三医院',
                       '南台学校财团法人南台科技大学',
                       '西交利物浦大学',
                       '健康科学西部大学',
                       '南特大学',
                       '中国人民解放军第二军医大学东方肝胆外科医院',
                       '西南林业大学',
                       '庆熙大学校产学协力团',
                       '浦项工科大学校产学协力团',
                       '拉弗朗特拉大学',
                       '逢甲大学',
                       '普林斯顿大学理事会',
                       '浙江工业大学上虞研究院有限公司',
                       '哈瓦那大学',
                       '台北医学大学',
                       '中国人民解放军陆军军医大学第二附属医院',
                       '中国人民解放军海军航空大学',
                       '米兰综合工科大学',
                       '全南大学校产学协力团',
                       '鲁汶大学',
                       '东国大学校产学协力团',
                       '浙江大学医学院附属妇产科医院',
                       '浙江中医药大学附属第一医院',
                       '威斯康星州医药大学股份有限公司',
                       '昆士兰大学',
                       '浙江工业大学工程设计集团有限公司',
                       '浙江大学建筑设计研究院有限公司',
                       '北部湾大学',
                       '同济大学建筑设计研究院(集团)有限公司',
                       '肯塔基大学研究基金会',
                       '中国人民解放军陆军军医大学',
                       '罗马大学',
                       '维也纳科技大学',
                       '瓦赫宁恩大学',
                       '第戎大学',
                       '伦敦大学',
                       '拉莫特特拉维夫大学有限公司',
                       '陆军工程大学军械士官学校',
                       '福建医科大学',
                       '科隆大学',
                       '中国人民武装警察部队工程大学',
                       '新昌浙江工业大学科学技术研究院',
                       '浙江大学舟山海洋研究中心',
                       '浙江理工大学桐乡研究院有限公司',
                       '燕山大学里仁学院',
                       '利兰斯坦福青年大学托管委员会',
                       '嘉泉大学校产学协力团',
                       '光云大学校产学协力团',
                       '电子科技大学广东电子信息工程研究院',
                       '森梅威斯大学',
                       '浙江工业大学义乌科学技术研究院有限公司',
                       '延世大学产学协力团',
                       '圣保罗州立大学胡代梅斯基塔菲略-UNESP',
                       '庆北大学校产学协力团',
                       '蓝康恒大学',
                       '浙江中医药大学附属第一医院(浙江省东方医院)',
                       '曼恩大学',
                       '瓦伦西亚大学',
                       '圣雄甘地大学',
                       '蓬查尤大学医学中心',
                       '西南医科大学附属医院',
                       '南澳大学',
                       '圣母大学',
                       '雷恩大学',
                       '印第安纳大学研究与技术公司',
                       '清华大学附属中学',
                       '集美大学诚毅学院',
                       '田纳西大学研究基金会',
                       '忠南大学教产学协力团',
                       '慈济学校财团法人慈济科技大学',
                       '忠南大学校产学协力团',
                       '崇实大学校',
                       '延世大学校原州产学协力团',
                       '凯斯西部预备大学',
                       '圣保罗大学',
                       '瓦赫宁根大学',
                       '南安普顿大学',
                       '中国人民解放军理工大学',
                       '同济大学太仓高新技术研究院',
                       '勤益科技大学',
                       '尼斯大学',
                       '东新大学校产学协力团',
                       '中国人民解放军第二军医大学第二附属医院',
                       '大学保健网络',
                       '华北电力大学扬中智能电气研究中心',
                       '公法法律教学医院H.O.D.N.LUMC莱顿大学医药中心',
                       '中国医药大学',
                       '帕尔马大学',
                       '沈阳建筑大学工厂',
                       '中国人民解放军火箭军工程大学',
                       '天主教大学',
                       '生物工程大学精神物质实验室',
                       '威廉马什莱斯大学',
                       '拉夫拉斯联邦大学',
                       '萨尔大学',
                       '伦敦大学学院',
                       '石河子大学医学院第一附属医院',
                       '庆北大学校',
                       '辛辛那提大学',
                       '仁荷大学校产学协力团',
                       '凯斯西储大学',
                       '乔治亚大学研究基金会',
                       '全北大学校产学协力团',
                       '关西大学',
                       '不来梅大学',
                       '洛林大学',
                       '屯特大学',
                       '图尔大学',
                       '中国政法大学',
                       '米兰理工大学',
                       '河海大学设计研究院有限公司',
                       '浙江财经大学',
                       '中国人民解放军国防科学技术大学',
                       '沈阳师范大学',
                       '普林斯顿大学',
                       '普瓦捷大学',
                       '苏黎士大学',
                       '黎巴嫩大学',
                       '亚眠大学',
                       '浙江财经大学东方学院',
                       '西北师范大学白银师科创新研究院',
                       '长庚学校财团法人长庚科技大学',
                       '塞维利亚大学',
                       '开普敦大学',
                       '东南大学附属中大医院',
                       '浙江大学医学院附属儿童医院',
                       '大理大学',
                       '江南大学附属医院',
                       '浙江大学先进电气装备创新中心',
                       '群山大学校产学协力团',
                       '图卢兹第三大学',
                       '维戈大学',
                       '浙江中医药大学',
                       '剑桥大学',
                       '东南大学成贤学院',
                       '滇西应用技术大学',
                       '中国矿业大学徐海学院',
                       '电子科技大学天府协同创新中心',
                       '圣何塞州立大学研究基金会',
                       '中国人民解放军空军军医大学',
                       '米尼奥大学',
                       '福建中医药大学',
                       '建国大学校GLOCAL产学协力团',
                       '三峡大学第一临床医学院、三峡大学附属中心人民医院',
                       '福建中医药大学附属康复医院',
                       '渤海大学',
                       '第戎大学地区中心医院',
                       '浙江大学城乡规划设计研究院有限公司',
                       '广东药科大学附属第一医院',
                       '中国科学技术大学附属第一医院',
                       '浙江农林大学暨阳学院',
                       '西北民族大学',
                       '乔治亚大学研究基金公司',
                       '莱昂大学',
                       '檀国大学校产学协力团',
                       '中央财经大学',
                       '帕维亚大学',
                       '旧金山州立大学',
                       '斯特拉斯堡大学医院',
                       '纳瓦拉大学',
                       '斯特拉斯堡大学医院研究所',
                       '暨南国际大学',
                       '南特大学医疗中心',
                       '顺天堂大学',
                       '西江大学校产学协力团',
                       '世宗大学校产学协力团',
                       '成均馆大学校',
                       '广东外语外贸大学',
                       '中国科学院自动化研究所',
                       '广东石油化工学院',
                       '金华职业技术学院',
                       '江西电力职业技术学院',
                       '广东省科学院动物研究所',
                       '国网技术学院',
                       '中国科学院过程工程研究所',
                       '中国科学院计算技术研究所',
                       '淮阴工学院',
                       '中国科学院西北高原生物研究所',
                       '中国科学院电工研究所',
                       '中国科学院化学研究所',
                       '台州学院',
                       '中国科学院遥感与数字地球研究所',
                       '中国农业科学院农业资源与农业区划研究所',
                       '仲恺农业工程学院',
                       '中国人民解放军军事科学院军事医学研究院',
                       '广东省农业科学院动物卫生研究所',
                       '中国人民解放军军事医学科学院生物工程研究所',
                       '广东省农业科学院水稻研究所',
                       '中国科学院微生物研究所',
                       '麻省理工学院',
                       '中国科学院近代物理研究所',
                       '中国人民解放军军事科学院防化研究院',
                       '江西省科学院微生物研究所',
                       '中国热带农业科学院农业机械研究所',
                       '福建省农业科学院畜牧兽医研究所',
                       '中国科学院物理研究所',
                       '中国科学院声学研究所',
                       '中国科学院空天信息创新研究院',
                       '中国人民解放军陆军防化学院',
                       '中国医学科学院阜外医院',
                       '中国地质科学院矿产资源研究所',
                       '中国科学院微电子研究所',
                       '广东省科学院微生物研究所(广东省微生物分析检测中心)',
                       '中国科学院海洋研究所',
                       '中原工学院',
                       '浙江科技学院',
                       '中国科学院沈阳自动化研究所',
                       '中国科学院福建物质结构研究所',
                       '广东省科学院资源利用与稀土开发研究所',
                       '中国科学院理化技术研究所',
                       '中国医学科学院医药生物技术研究所',
                       '中国科学院华南植物园',
                       '学校法人关西学院',
                       '中国科学院分子细胞科学卓越创新中心',
                       '中国科学院力学研究所',
                       '西奈山伊坎医学院',
                       '中国科学院电子学研究所',
                       '中国科学院半导体研究所',
                       '中国科学院高能物理研究所',
                       '中国科学院动物研究所',
                       '中国农业科学院饲料研究所',
                       '中国科学院光电技术研究所',
                       '淮海工学院',
                       '中国农业科学院农产品加工研究所',
                       '中国科学院亚热带农业生态研究所',
                       '中国农业科学院烟草研究所',
                       '军事科学院系统工程研究院军需工程技术研究所',
                       '中国医学科学院生物医学工程研究所',
                       '广东省农业科学院农业资源与环境研究所',
                       '中国科学院西双版纳热带植物园',
                       '中国科学院城市环境研究所',
                       '中国人民解放军装备学院',
                       '中国科学院地理科学与资源研究所',
                       '中国热带农业科学院热带生物技术研究所',
                       '中国科学院地球化学研究所',
                       '中国科学院金属研究所',
                       '中国农业科学院作物科学研究所',
                       '广东省科学院新材料研究所',
                       '中国农业科学院棉花研究所',
                       '中国热带农业科学院南亚热带作物研究所',
                       '金陵科技学院',
                       '中国农业科学院植物保护研究所',
                       '中国科学院地质与地球物理研究所',
                       '中国科学院工程热物理研究所',
                       '中国科学院生态环境研究中心',
                       '中国科学院西北生态环境资源研究院',
                       '中国农业科学院农业质量标准与检测技术研究所',
                       '中国人民解放军军事科学院国防科技创新研究院',
                       '加州理工学院',
                       '中国科学院光电研究院',
                       '中国热带农业科学院农产品加工研究所',
                       '中国科学院国家空间科学中心',
                       '中国人民解放军军事医学科学院毒物药物研究所',
                       '江西省科学院应用化学研究所',
                       '中国地质科学院地球物理地球化学勘查研究所',
                       '中国农业科学院麻类研究所',
                       '中国农业科学院茶叶研究所',
                       '中国农业科学院蔬菜花卉研究所',
                       '中国人民解放军军事医学科学院放射与辐射医学研究所',
                       '军事科学院系统工程研究院网络信息研究所',
                       '乌克兰国家科学院E.O.巴顿电焊接研究所',
                       '武昌理工学院',
                       '湘南学院',
                       '中国科学院数学与系统科学研究院',
                       '浙江省农业科学院',
                       '武夷学院',
                       '中国科学院软件研究所',
                       '荆楚理工学院',
                       '中国科学院南海海洋研究所',
                       '黄冈师范学院',
                       '中国医学科学院药用植物研究所',
                       '国立里昂应用科学学院',
                       '中国科学院深海科学与工程研究所',
                       '伦敦国王学院',
                       '中国农业科学院蜜蜂研究所',
                       '广东省农业科学院农业生物基因研究中心',
                       '中国科学院遗传与发育生物学研究所',
                       '军事科学院军事医学研究院环境医学与作业医学研究所',
                       '中国医学科学院肿瘤医院',
                       '军事科学院军事医学研究院生命组学研究所',
                       '中国医学科学院药物研究所',
                       '广东环境保护工程职业学院',
                       '中国科学院微小卫星创新研究院',
                       '广东职业技术学院',
                       '苏黎世联邦理工学院',
                       '北华航天工业学院',
                       '中国科学院信息工程研究所',
                       '浙江树人学院',
                       '广东省农业科学院蚕业与农产品加工研究所',
                       '江西省农业科学院农业应用微生物研究所(江西省农村能源研究中心)',
                       '中国农业科学院农业经济与发展研究所',
                       '中国人民解放军军事医学科学院野战输血研究所',
                       '百色学院',
                       '格勒诺布尔国立理工学院',
                       '齐鲁师范学院',
                       '江西省科学院能源研究所',
                       '中国中医科学院中药研究所',
                       '中国人民解放军陆军装甲兵学院',
                       '中国农业科学院油料作物研究所',
                       '国家电网有限公司技术学院分公司',
                       '中国科学院分子植物科学卓越创新中心',
                       '中国地质科学院勘探技术研究所',
                       '辽东学院',
                       '中国农业科学院农业环境与可持续发展研究所',
                       '中国医学科学院病原生物学研究所',
                       '中国热带农业科学院环境与植物保护研究所',
                       '广东省农业科学院蔬菜研究所',
                       '华北科技学院',
                       '中国农业科学院农业信息研究所',
                       '中国科学院植物研究所',
                       '闽江学院',
                       '伊犁师范学院',
                       '中国科学院沈阳应用生态研究所',
                       '中国科学院国家授时中心',
                       '中国医学科学院医学生物学研究所',
                       '中国科学院水生生物研究所',
                       '贵阳学院',
                       '黄淮学院',
                       '广东技术师范学院',
                       '中国医学科学院放射医学研究所',
                       '中国人民解放军军事科学院评估论证研究中心',
                       '沈阳体育学院',
                       '长江水利委员会长江科学院',
                       '中国地质科学院矿产综合利用研究所',
                       '浙江交通职业技术学院',
                       '中国人民解放军空军勤务学院',
                       '福建工程学院',
                       '中国人民解放军军事医学科学院微生物流行病研究所',
                       '江西省农业科学院植物保护研究所',
                       '中国人民解放军后勤工程学院',
                       '皖西学院',
                       '达特茅斯学院理事会',
                       '中国科学院数据与通信保护研究教育中心',
                       '水利部中国科学院水工程生态研究所',
                       '江西省农业科学院畜牧兽医研究所',
                       '中国科学院生物物理研究所',
                       '中国地质科学院地质力学研究所',
                       '广东省科学院智能制造研究所',
                       '浙江省医学科学院',
                       '中国科学院国家天文台',
                       '柳州铁道职业技术学院',
                       '广东省科学院产业技术育成中心',
                       '广东省农业科学院茶叶研究所',
                       '河西学院',
                       '军事科学院军事医学研究院微生物流行病研究所',
                       '包头职业技术学院',
                       '中国人民解放军防空兵学院',
                       '中国农业科学院农业基因组研究所',
                       '广东南华工商职业学院',
                       '西京学院',
                       '中国农业科学院烟草研究所(中国烟草总公司青州烟草研究所)',
                       '阳光学院',
                       '中国科学院包头稀土研发中心',
                       '江西环境工程职业学院',
                       '中国农业科学院生物技术研究所',
                       '赣南医学院',
                       '福建省农业科学院果树研究所',
                       '广东省科学院工业分析检测中心',
                       '中国农业科学院都市农业研究所',
                       '蒙特利尔综合理工学院公司',
                       '中国医学科学院基础医学研究所',
                       '加利福尼亚理工学院',
                       '里昂高等师范学院',
                       '河套学院',
                       '中国人民解放军陆军炮兵防空兵学院',
                       '中国人民武装警察部队海警学院',
                       '江西省科学院生物资源研究所',
                       '广东轻工职业技术学院',
                       '中国地质科学院水文地质环境地质研究所',
                       '汉诺威医学院',
                       '中国科学院计算机网络信息中心',
                       '中国科学院空间应用工程与技术中心',
                       '广东省科学院化工研究所',
                       '中国农业科学院特产研究所',
                       '广东省农业科学院植物保护研究所',
                       '广东南方职业学院',
                       '浙江安防职业技术学院',
                       '中国热带农业科学院香料饮料研究所',
                       '福建省中医药科学院',
                       '国家高等先进技术学院',
                       '广东省农业科学院作物研究所',
                       '浙江警察学院',
                       '中国中医科学院中医基础理论研究所',
                       '顺德职业技术学院',
                       '福建省农业科学院科技干部培训中心',
                       '中国人民解放军军事医学科学院军事兽医研究所',
                       '中国消防救援学院',
                       '淮阴师范学院',
                       '贵阳中医学院第一附属医院',
                       '柳州工学院',
                       '钦州学院',
                       '江西省科学院',
                       '中国人民解放军陆军装甲兵学院士官学校',
                       '中国医学科学院血液病医院(中国医学科学院血液学研究所)',
                       '福建省农业科学院生物技术研究所',
                       '陇东学院',
                       '中国科学院精密测量科学与技术创新研究院',
                       '浙江纺织服装职业技术学院',
                       '中国科学院计算技术研究所数字经济产业研究院',
                       '中国科学院心理研究所',
                       '广东省人民医院(广东省医学科学院)',
                       '广东警官学院(广东省公安司法管理干部学院)',
                       '广东食品药品职业学院',
                       '中国医学科学院医学实验动物研究所',
                       '中国人民解放军陆军勤务学院',
                       '中国科学院遗传与发育生物学研究所农业资源研究中心',
                       '中国热带农业科学院',
                       '宜春学院',
                       '中国医学科学院皮肤病医院(中国医学科学院皮肤病研究所)',
                       '楚雄师范学院',
                       '中国农业科学院草原研究所',
                       '黄河科技学院',
                       '江西省水利科学院',
                       '中国地质科学院探矿工艺研究所',
                       '斯克里普斯研究学院',
                       '中国科学院脑科学与智能技术卓越创新中心',
                       '福建省农业科学院农业生态研究所',
                       '泰山医学院',
                       '中国科学院地球环境研究所',
                       '福建江夏学院',
                       '福建省农业科学院植物保护研究所',
                       '浙大城市学院',
                       '浙江万里学院',
                       '黄河水利职业技术学院',
                       '川北医学院',
                       '承德医学院',
                       '广东工程职业技术学院',
                       '岭南师范学院',
                       '广东省科学院电子电器研究所',
                       '中国民用航空飞行学院',
                       '中国民航管理干部学院',
                       '浙江传媒学院',
                       '军事科学院系统工程研究院军用标准研究中心',
                       '中国科学院大气物理研究所',
                       '中国科学院国有资产经营有限责任公司',
                       '中国科学院控股有限公司',
                       '中国人民解放军国防信息学院',
                       '中国人民解放军陆军军事交通学院',
                       '赣南医学院第一附属医院',
                       '长江师范学院',
                       '乌兹别克斯坦科学院及农业和水资源部',
                       '蓝科纳医学研究学院',
                       '中国科学院沈阳计算技术研究所有限公司',
                       '中国科学院沈阳科学仪器股份有限公司',
                       '中国科学院声学研究所南海研究站',
                       '军事科学院军事医学研究院科研保障中心',
                       '泰山学院',
                       '江西省农业科学院农产品质量安全与标准研究所',
                       '中国人民解放军海军航空工程学院',
                       '中国科学院等离子体物理研究所',
                       '沈阳科技学院',
                       '福建省农业科学院农业质量标准与检测技术研究所',
                       '福建省农业科学院农业生物资源研究所',
                       '福建林业职业技术学院',
                       '加泰罗尼亚调研高等研究学院',
                       '中国科学院高能物理研究所天府宇宙线研究中心',
                       '嘉应学院',
                       '江西省林业科学院',
                       '江西应用技术职业学院',
                       '红河学院',
                       '军事科学院系统工程研究院军事新能源技术研究所',
                       '江西省农业科学院农业经济与信息研究所',
                       '中国人民解放军装甲兵工程学院',
                       '中国农业科学院甜菜研究所',
                       '中国科学院古脊椎动物与古人类研究所',
                       '广东第二师范学院',
                       '加利福尼亚技术学院',
                       '中国中医科学院望京医院',
                       '黔南民族师范学院',
                       '福建电力职业技术学院',
                       '湄洲湾职业技术学院',
                       '广东省科学院生物工程研究所',
                       '中国人民解放军军事科学院国防工程研究院工程防护研究所',
                       '铁道警察学院',
                       '福建商学院',
                       '学校法人上智学院',
                       '文山壮族苗族自治州农业科学院',
                       '包头轻工职业技术学院',
                       '格勒诺布尔综合理工学院',
                       '潇湘职业学院',
                       '军事科学院系统工程研究院后勤科学与技术研究所',
                       '红河哈尼族彝族自治州农业科学院',
                       '中国地质科学院',
                       '赤峰学院',
                       '福建省闽北职业技术学院',
                       '广东省科学院生态环境与土壤研究所',
                       '中国环境管理干部学院',
                       '广东水利电力职业技术学院(广东省水利电力技工学校)',
                       '浙江水利水电学院',
                       '军事科学院系统工程研究院卫勤保障技术研究所',
                       '广东省科学院生物与医学工程研究所',
                       '浙江外国语学院',
                       '国家健康和医学研究学院-INSERM',
                       '文山学院',
                       '中国农业科学院西部农业研究中心',
                       '克里特教育技术学院',
                       '中国中医科学院西苑医院',
                       '巢湖学院',
                       '楚雄彝族自治州农业科学院',
                       '洛桑聚合联合学院',
                       '居里学院',
                       '图卢兹国立理工学院',
                       '沈阳医学院附属中心医院',
                       '广东机电职业技术学院',
                       '近都柏林之伊丽莎白皇后神圣及不可分割的三位一体学院之教务长',
                       '中国科学院北方粳稻分子育种联合研究中心',
                       '广东省农业科学院环境园艺研究所',
                       '泰山医学院附属医院',
                       '广东省农业科学院农业质量标准与监测技术研究所',
                       '农业和机械学院',
                       '中国科学院科技战略咨询研究院',
                       '贝勒医学院',
                       '伊犁技师培训学院',
                       '中国人民解放军医学院',
                       '卡塔拉纳调查及高级研究学院',
                       '中央理工-高等电力学院',
                       '广东行政职业学院',
                       '南宁职业技术学院',
                       '中国科学院紫金山天文台',
                       '中国热带农业科学院热带作物品种资源研究所',
                       '广东省科学院材料与加工研究所',
                       '广东省科学院资源综合利用研究所',
                       '中国人民解放军军事科学院战争研究院',
                       '中国科学院寒区旱区环境与工程研究所',
                       '卡昂国立高等工程师学院',
                       '中国科学院力学研究所广东空天科技研究院',
                       '沈阳工程学院',
                       '国立巴黎高等化学学院',
                       '集宁师范学院',
                       '朱勒凡尔纳技术研究学院',
                       '高等研究实践学院',
                       '锡林郭勒职业学院',
                       '伊犁职业技术学院',
                       '质量和技术学院-INMETRO',
                       '高等农艺科学学院',
                       '国家药品监督管理局高级研修学院(国家药品监督管理局安全应急演练中心)',
                       '浙江国际海运职业技术学院',
                       '鲁昂诺曼底国立应用科学学院', ]
        for i in school_list:
            self.bro.get(
                "https://zh.wikipedia.org/w/index.php?search=%E5%9B%BD%E7%AB%8B%E5%A4%A7%E5%AD%A6%E6%B3%95%E4%BA%BA%E5%B1%B1%E5%8F%A3%E5%A4%A7%E5%AD%A6&title=Special%3A%E6%90%9C%E7%B4%A2&ns0=1")
            school_dict = dict()
            school_dict['search'] = i
            sleep(6)
            while True:
                try:
                    search_input_ex = self.bro.find_element(By.XPATH,
                                                            "//input[@name='search' and @placeholder='搜索维基百科' and @class='cdx-text-input__input']")
                    search_input_ex.clear()
                    search_input_ex.send_keys(i)
                    sleep(1)
                    break
                except:
                    continue

            search_button_ex = self.bro.find_element(By.XPATH,
                                                     "//button[text()='搜索' and contains(@class,'cdx-search-input__end-button')]")
            search_button_ex.click()

            sleep(1)

            try:
                search_results_ex = self.bro.find_element(By.XPATH,
                                                          "//ul[@class='mw-search-results']/li[1]//div[@class='mw-search-result-heading']/a")
                search_results_ex.click()
                sleep(5)
            except:
                print("暂无搜索结果")

            try:
                school_title_ex = self.bro.find_element(By.XPATH,
                                                        "//table[@class='infobox vcard']//th[@class='fn org']")
                school_title = school_title_ex.text
                school_dict['school_title'] = school_title
            except:
                school_title = 'null'
                school_dict['school_title'] = school_title

            try:
                school_address_ex = self.bro.find_element(By.XPATH,
                                                          "//table[@class='infobox vcard']//th[text()='校址']/following-sibling::td[@class='adr']")
                school_address = school_address_ex.text
                school_dict['school_address'] = school_address
            except:
                school_address = 'null'
                school_dict['school_address'] = school_address

            print(school_dict)
            self.school_data.append(school_dict)

        self.export_data(self.school_data)

    # 导出为Excel文件
    def export_excel(self, filename):
        filePath = os.path.join(self.BASE_DIR, 'utils\\data.pickle')
        if os.path.exists(filePath):
            pass
        else:
            return "数据文件不存在，请先爬取数据后在导出数据"

        data = pickle.load(open(filePath, "rb"))
        data1 = []
        for i in data:
            if isinstance(i, dict):
                data1.append(i)

        df = pd.DataFrame(data=data1)
        filename = filename + '.xlsx'
        filePath = os.path.join(self.BASE_DIR, filename)
        try:
            df.to_excel(filePath, index=False)
            return "导出路径：" + filePath
        except Exception as e:
            return str(e)

    def export_data(self, data):
        filePath1 = os.path.join(self.BASE_DIR, 'utils\\data.pickle')
        with open(filePath1, 'wb') as f:
            pickle.dump(data, f)


if __name__ == '__main__':
    aqc = aiqicha()
    try:
        aqc.college_reptile()
    except:
        aqc.export_data(aqc.company_data)
    aqc.export_excel("学校")
